<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citation Display Test</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h1>Citation Display Test</h1>
        
        <!-- Minimal test structure -->
        <div id="mistakesBox" class="issues-section">
            <h3>Issues Identified</h3>
            <ol id="mistakesList" class="issues-list">
                <li>Test mistake 1</li>
                <li>Test mistake 2</li>
            </ol>
        </div>
        
        <!-- Button to test citation display -->
        <button onclick="testCitations()">Test Citation Display</button>
        
        <script>
            // Test citations display function
            function displayCitations(citations) {
                // Filter out empty or whitespace-only citations
                const validCitations = citations.filter(citation => citation && citation.trim().length > 0);
                
                // Find or create citations container
                let citationsBox = document.getElementById('citationsBox');
                if (!citationsBox) {
                    // Create citations box if it doesn't exist
                    citationsBox = document.createElement('div');
                    citationsBox.id = 'citationsBox';
                    citationsBox.className = 'citations-box';
                    citationsBox.innerHTML = `
                        <h3>Citations and References</h3>
                        <ul id="citationsList"></ul>
                    `;
                    // Insert after mistakes box
                    const mistakesBox = document.getElementById('mistakesBox');
                    mistakesBox.parentNode.insertBefore(citationsBox, mistakesBox.nextSibling);
                }
                
                const citationsList = document.getElementById('citationsList');
                
                if (validCitations.length > 0) {
                    citationsList.innerHTML = '';
                    validCitations.forEach((citation, index) => {
                        const li = document.createElement('li');
                        li.textContent = citation.trim();
                        citationsList.appendChild(li);
                    });
                    citationsBox.style.display = 'block';
                    console.log('Citations displayed:', validCitations);
                } else {
                    citationsBox.style.display = 'none';
                    console.log('No valid citations to display');
                }
            }
            
            function testCitations() {
                console.log('Testing citation display...');
                
                // Test with empty citations
                displayCitations([]);
                
                // Test with valid citations
                setTimeout(() => {
                    const testCitations = [
                        "CUHK English Style Guide, Section 2.1: Grammar Rules",
                        "CUHK Chinese Style Guide, Section 1.3: Character Usage"
                    ];
                    displayCitations(testCitations);
                    alert('Check the page for citations box!');
                }, 1000);
            }
            
            // Test on page load
            window.addEventListener('load', function() {
                console.log('Page loaded, testing citations...');
                
                // Simulate the citation display that should happen after API response
                setTimeout(() => {
                    const testCitations = [
                        "CUHK English Style Guide, Section 2.1: Grammar Rules"
                    ];
                    displayCitations(testCitations);
                }, 2000);
            });
        </script>
    </div>
</body>
</html>
